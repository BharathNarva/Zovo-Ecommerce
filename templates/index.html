{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>{{ site_name }} Ecommerce</title>

<!-- Google Fonts for modern logo -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet">

<!-- FontAwesome for icons -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

<style>
/* ====================== GENERAL STYLES ====================== */
body {
    margin: 0;
    font-family: 'Arial', sans-serif;
    background-color: #f5f5f5;
    color: #333;
}

/* ====================== NAVBAR ====================== */
.navbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 25px;
    background-color: #fff;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    position: sticky;
    top: 0;
    z-index: 1000;
}

/* ================= LOGO STYLING ================= */
.logo {
  display: flex;
  align-items: center;
  gap: 10px;
}

.logo-icon {
  width: 40px;
  height: 40px;
  background-color: #ff6600; 
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-weight: bold;
  font-size: 20px;
  transition: transform 0.3s; 
}

.logo-icon:hover { transform: scale(1.2); }

.logo-text {
  font-family: 'Poppins', sans-serif;
  font-weight: 700;
  font-size: 24px;
  color: #ff6600;
  letter-spacing: 1px;
  margin: 0;
  animation: logoFadeIn 1s ease forwards;
}

@keyframes logoFadeIn {
  from {opacity:0; transform: translateY(-10px);}
  to {opacity:1; transform: translateY(0);}
}

/* ====================== SEARCH BAR ====================== */
.search-bar {
    flex: 1;
    display: flex;
    margin: 0 20px;
}

.search-bar input {
    flex: 1;
    padding: 8px 15px;
    border-radius: 4px 0 0 4px;
    border: 1px solid #ccc;
    outline: none;
}

.search-bar button {
    padding: 8px 15px;
    border: none;
    background: #ff6600;
    color: white;
    cursor: pointer;
    border-radius: 0 4px 4px 0;
}

/* ====================== NAV LINKS ====================== */
.nav-links {
    display: flex;
    gap: 15px;
    align-items: center;
}

.nav-links a {
    color: #333;
    text-decoration: none;
    font-size: 14px;
}

.nav-links a:hover { color: #ff6600; }

.cart-link span {
    background: #ff6600;
    padding: 2px 6px;
    border-radius: 50%;
    font-size: 12px;
    color: #fff;
    margin-left: 5px;
}

/* ====================== CATEGORY BAR ====================== */
.category-bar {
    display: flex;
    overflow-x: auto;
    padding: 10px 20px;
    background: #fff;
    gap: 15px;
}

.category-bar::-webkit-scrollbar { display: none; }

.category-item {
    padding: 5px 15px;
    background: #eee;
    border-radius: 20px;
    cursor: pointer;
    transition: 0.3s;
    font-size: 14px;
}

.category-item.active, .category-item:hover {
    background: #ff6600;
    color: white;
}

/* ====================== HERO SLIDER ====================== */
.hero-slider {
    position: relative;
    width: 100%;
    overflow: hidden;
    margin-bottom: 20px;
    border-radius: 8px;
}

.slides {
    display: flex;
    transition: transform 0.5s ease-in-out;
}

.slide {
    min-width: 100%;
    position: relative;
}

.slide img {
    width: 100%;
    max-height: 400px;
    object-fit: cover;
    border-radius: 8px;
}

/* Slider arrows */
.slider-arrow {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    font-size: 30px;
    color: #fff;
    background: rgba(0,0,0,0.4);
    padding: 10px;
    border-radius: 50%;
    cursor: pointer;
    user-select: none;
    z-index: 10;
}

.slider-arrow.left { left: 10px; }
.slider-arrow.right { right: 10px; }
.slider-arrow:hover { background: rgba(0,0,0,0.6); }

/* Slider dots */
.slider-dots {
    position: absolute;
    bottom: 15px;
    width: 100%;
    text-align: center;
}

.slider-dot {
    height: 12px;
    width: 12px;
    margin: 0 5px;
    display: inline-block;
    background-color: #bbb;
    border-radius: 50%;
    cursor: pointer;
    transition: background-color 0.3s;
}

.slider-dot.active { background-color: #ff6600; }

/* ====================== PRODUCT GRID ====================== */
.product-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    padding: 0 20px 30px 20px;
}

.product-card {
    background: #fff;
    padding: 15px;
    border-radius: 8px;
    text-align: center;
    position: relative;
    transition: transform 0.3s, box-shadow 0.3s;
}

.product-card:hover { transform: translateY(-5px); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }

.product-card img {
    max-width: 100%;
    border-radius: 6px;
    height: 150px;
    object-fit: cover;
}

.product-card h3 { font-size: 16px; margin: 10px 0 5px 0; }

.product-card p { font-size: 13px; color: #666; margin: 5px 0; }

.product-card button {
    margin-top: 10px;
    padding: 8px 12px;
    border: none;
    background: #ff6600;
    color: #fff;
    border-radius: 4px;
    cursor: pointer;
}

.product-card button:hover { background: #ff8533; }

/* Discount badge */
.discount-badge {
    position: absolute;
    top: 10px;
    left: 10px;
    background: #ff3b3b;
    color: #fff;
    font-size: 12px;
    padding: 4px 6px;
    border-radius: 4px;
}

/* Low stock label */
.low-stock { color: #ff3b3b; font-size: 12px; }

/* ====================== FOOTER ====================== */
.footer {
    background-color: #fff;
    padding: 40px 20px;
    border-top: 1px solid #ccc;
}

.footer h3 { color: #333; margin-bottom: 10px; }

.footer p, .footer a { color: #666; text-decoration: none; font-size: 14px; }
.footer a:hover { color: #ff6600; }

/* ====================== TOAST ====================== */
.toast-container {
    position: fixed;
    top: 20px;
    right: 20px;
    display: flex;
    flex-direction: column;
    gap: 10px;
    z-index: 9999;
}

.toast {
    padding: 12px 20px;
    border-radius: 8px;
    background: #2ecc71;
    color: #fff;
    font-weight: bold;
    animation: toastFadeIn 0.5s, toastFadeOut 0.5s 2.5s;
}

.toast.error { background: #e74c3c; }

@keyframes toastFadeIn {
    from {opacity:0; transform:translateY(-10px);}
    to {opacity:1; transform:translateY(0);}
}

@keyframes toastFadeOut {
    from {opacity:1; transform:translateY(0);}
    to {opacity:0; transform:translateY(-10px);}
}

/* ====================== RESPONSIVE ====================== */
@media (max-width: 600px) {
    .search-bar { margin: 0 10px; }
    .product-card img { height: 120px; }
    .hero-slider .slide img { max-height: 250px; }
}
</style>
</head>
<body>

<!-- ====================== NAVBAR ====================== -->
<div class="navbar">
    <!-- Logo with icon and text -->
    <div class="logo">
        <div class="logo-icon">Z</div>
        <div class="logo-text"> ZoVo </div>
    </div>

    <!-- Search bar -->
    <div class="search-bar">
        <input type="text" id="searchInput" placeholder="Search products...">
        <button id="searchBtn"><i class="fas fa-search"></i></button>
    </div>

    <!-- Navigation links -->
    <div class="nav-links">
        <a href="#">Sign In</a>
        <a href="#">Orders</a>
        <a href="{% url 'cart_view' %}" class="cart-link">
            <i class="fas fa-shopping-cart"></i> Cart <span id="cart-count">0</span>
        </a>
    </div>
</div>

<!-- ====================== CATEGORY BAR ====================== -->
<div class="category-bar" id="categoryBar">
    <span class="category-item active" data-cat="all">All</span>
    {% for cat in categories %}
        <span class="category-item" data-cat="{{ cat|lower }}">{{ cat }}</span>
    {% endfor %}
</div>

<!-- ====================== HERO SLIDER ====================== -->
<section class="hero-slider">
    <div class="slides" id="heroSlides">
        {% for banner in banners %}
        <div class="slide">
            <img src="{{ banner.image.url }}" alt="{{ banner.title }}">
        </div>
        {% endfor %}
    </div>
    <div class="slider-arrow left" id="prevSlide">&#10094;</div>
    <div class="slider-arrow right" id="nextSlide">&#10095;</div>
    <div class="slider-dots" id="sliderDots"></div>
</section>

<!-- ====================== TRENDING PRODUCTS ====================== -->
<section class="trending">
    <h2 style="padding:0 20px;">ðŸ”¥ Trending / Flash Deals</h2>
    <div class="product-grid" id="trendingGrid"></div>
</section>

<!-- ====================== ALL PRODUCTS ====================== -->
<section class="all-products">
    <h2 style="padding:0 20px;">ðŸ›’ All Products</h2>
    <div class="product-grid" id="allProductGrid"></div>
</section>

<!-- ====================== FOOTER ====================== -->
<footer class="footer">
    <div style="display:grid; grid-template-columns: repeat(auto-fit,minmax(200px,1fr)); gap:20px;">
        <div>
            <h3>About {{ site_name }}</h3>
            <p>{{ site_name }} provides quality products at best prices.</p>
        </div>
        <div>
            <h3>Quick Links</h3>
            <a href="#">Home</a><br>
            <a href="#">Products</a><br>
            <a href="#">Contact</a>
        </div>
        <div>
            <h3>Policies</h3>
            <a href="#">Privacy</a><br>
            <a href="#">Terms</a>
        </div>
    </div>
</footer>

<!-- ====================== TOAST ====================== -->
<div class="toast-container" id="toastContainer"></div>

<!-- ====================== SCRIPT ====================== -->
<script>
// ====================== CART ======================
let cart = JSON.parse(localStorage.getItem("cart")) || [];
const cartCountElement = document.getElementById("cart-count");

// Update cart count and store in localStorage
function updateCart() {
    let totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
    cartCountElement.textContent = totalItems;
    localStorage.setItem("cart", JSON.stringify(cart));
}

// Show toast notifications
function showToast(msg, type="success") {
    const toast = document.createElement("div");
    toast.className = "toast " + type;
    toast.textContent = msg;
    document.getElementById("toastContainer").appendChild(toast);
    setTimeout(() => toast.remove(), 3000);
}

// Add to cart function with stock check
document.addEventListener("click", e => {
    if (e.target.classList.contains("add-to-cart")) {
        const card = e.target.closest(".product-card");
        const id = card.dataset.id;
        const name = card.dataset.name;
        const price = parseFloat(card.dataset.price);
        const stock = parseInt(card.dataset.stock);

        // Check stock before adding
        let existing = cart.find(i => i.id === id);
        if (existing) {
            if(existing.quantity + 1 > stock) {
                showToast(`Only ${stock} item(s) left in stock!`, "error");
                return;
            }
            existing.quantity += 1;
        } else {
            if(stock <= 0) { showToast(`${name} is out of stock!`, "error"); return; }
            cart.push({id, name, price, quantity: 1});
        }

        updateCart();
        showToast(`${name} added to cart!`);
    }
});
updateCart();

// ====================== PRODUCT CARDS ======================
const trendingGrid = document.getElementById("trendingGrid");
const allProductGrid = document.getElementById("allProductGrid");
const categoryBar = document.getElementById("categoryBar");
let allProducts = [];

// Render product cards dynamically
function renderProductCards(products, container) {
    container.innerHTML = "";
    if (products.length === 0) return;
    products.forEach(p => {
        const card = document.createElement("div");
        card.className = "product-card";
        card.dataset.id = p.id;
        card.dataset.name = p.name;
        card.dataset.category = p.category.toLowerCase();
        card.dataset.price = p.discounted_price || p.price;
        card.dataset.stock = p.stock_quantity;

        let imgSrc = p.image_url || "{% static 'images/placeholder.png' %}";
        let discountHTML = p.discounted_price ? `<div class="discount-badge">SALE</div>` : "";
        let lowStockHTML = p.stock_quantity < 5 ? `<p class="low-stock">Only ${p.stock_quantity} left!</p>` : "";

        card.innerHTML = `
            ${discountHTML}
            <img src="${imgSrc}" alt="${p.name}">
            <h3>${p.name}</h3>
            <p>${p.description}</p>
            <p>${p.discounted_price ? `<span style="text-decoration: line-through;">â‚¹${p.price}</span> <span style="color:#ff6600;font-weight:bold;">â‚¹${p.discounted_price}</span>` : `â‚¹${p.price}`}</p>
            ${lowStockHTML}
            <button class="add-to-cart">Add to Cart</button>
        `;
        container.appendChild(card);
    });
}

// ====================== FETCH PRODUCTS ======================
async function fetchProducts() {
    const res = await fetch("{% url 'ajax_products' %}");
    const data = await res.json();

    allProducts = data.all_products;

    // Trending / Flash deals
    const trendingProducts = data.trending_products.concat(data.flash_deals);
    renderProductCards(trendingProducts, trendingGrid);

    renderProductCards(allProducts, allProductGrid);

    renderCategoryBar();
}
fetchProducts();

// ====================== CATEGORY FILTER ======================
function renderCategoryBar() {
    const catSet = new Set(allProducts.map(p => p.category.toLowerCase()));
    categoryBar.innerHTML = '<span class="category-item active" data-cat="all">All</span>';
    catSet.forEach(c => {
        const span = document.createElement("span");
        span.className = "category-item";
        span.dataset.cat = c;
        span.textContent = c.charAt(0).toUpperCase() + c.slice(1);
        categoryBar.appendChild(span);
    });

    document.querySelectorAll(".category-item").forEach(item => {
        item.addEventListener("click", () => {
            document.querySelectorAll(".category-item").forEach(i => i.classList.remove("active"));
            item.classList.add("active");
            const cat = item.dataset.cat;
            const filtered = cat === "all" ? allProducts : allProducts.filter(p => p.category.toLowerCase() === cat);
            renderProductCards(filtered, allProductGrid);
        });
    });
}

// ====================== SEARCH ======================
const searchInput = document.getElementById("searchInput");
const searchBtn = document.getElementById("searchBtn");

searchBtn.addEventListener("click", filterProducts);
searchInput.addEventListener("keypress", e => { if (e.key === "Enter") filterProducts(); });

function filterProducts() {
    const query = searchInput.value.toLowerCase();
    const filtered = allProducts.filter(p => p.name.toLowerCase().includes(query) || p.description.toLowerCase().includes(query));
    renderProductCards(filtered, allProductGrid);
}

// ====================== HERO SLIDER ======================
const slides = document.querySelectorAll('.slide');
const dotsContainer = document.getElementById('sliderDots');
let currentSlide = 0;

// Create dots
slides.forEach((_, index) => {
    const dot = document.createElement('span');
    dot.className = 'slider-dot' + (index === 0 ? ' active' : '');
    dot.addEventListener('click', () => goToSlide(index));
    dotsContainer.appendChild(dot);
});

function showSlide(index) {
    if(index >= slides.length) index = 0;
    if(index < 0) index = slides.length - 1;
    slides.forEach((slide) => slide.style.display = 'none');
    slides[index].style.display = 'block';
    document.querySelectorAll('.slider-dot').forEach(dot => dot.classList.remove('active'));
    document.querySelectorAll('.slider-dot')[index].classList.add('active');
    currentSlide = index;
}

function nextSlide() { showSlide(currentSlide + 1); }
function prevSlide() { showSlide(currentSlide - 1); }

document.getElementById('nextSlide').addEventListener('click', nextSlide);
document.getElementById('prevSlide').addEventListener('click', prevSlide);

// Auto slide
showSlide(0);
setInterval(nextSlide, 5000);

</script>
</body>
</html>
